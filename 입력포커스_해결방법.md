# React Native TextInput 포커스 손실 문제 해결 방법

## 🔍 문제 상황
React Native에서 TextInput 입력 중 포커스가 갑자기 사라지는 현상이 발생

### 증상
- 텍스트 입력 중 갑자기 키보드가 사라짐
- 포커스가 해제되어 입력이 중단됨
- 매번 TextInput을 다시 터치해야 함

## 🕵️ 문제 원인 분석

### 주요 원인: 컴포넌트 재생성
React Native에서 **컴포넌트가 매번 새로 생성**되어 리렌더링될 때 TextInput의 포커스가 사라지는 현상

### 상세 원인
```typescript
// ❌ 문제가 되는 코드 패턴
const MyScreen = () => {
  const [text, setText] = useState('');
  
  // 💥 이 함수형 컴포넌트가 매번 새로 생성됨
  const MyInput = ({ value, onChangeText }) => (
    <TextInput value={value} onChangeText={onChangeText} />
  );
  
  return (
    <MyInput value={text} onChangeText={setText} />
  );
};
```

### 발생 메커니즘
1. **state 변경** (예: `setText` 호출)
2. **컴포넌트 리렌더링** 발생
3. **MyInput 함수가 새로 생성**됨
4. **React가 이전 TextInput과 다른 컴포넌트로 인식**
5. **기존 TextInput 제거 후 새로운 TextInput 생성**
6. **포커스 손실** 💥

## ✅ 해결 방법

### 방법 1: 컴포넌트 외부 분리 + React.memo (권장)

```typescript
// ✅ 해결된 코드
// 1. 컴포넌트를 외부로 분리
const MyInput = React.memo(({ 
  value, 
  onChangeText,
  placeholder,
  editable = true
}: {
  value: string;
  onChangeText: (text: string) => void;
  placeholder: string;
  editable?: boolean;
}) => (
  <TextInput
    value={value}
    onChangeText={onChangeText}
    placeholder={placeholder}
    editable={editable}
  />
));

// 2. 메인 컴포넌트에서 사용
const MyScreen = () => {
  const [text, setText] = useState('');
  const [loading, setLoading] = useState(false);
  
  return (
    <MyInput 
      value={text} 
      onChangeText={setText}
      placeholder="입력하세요"
      editable={!loading}
    />
  );
};
```

### 방법 2: useCallback 활용

```typescript
// ✅ 대안 방법
const MyScreen = () => {
  const [text, setText] = useState('');
  
  // useCallback으로 함수 메모이제이션
  const handleTextChange = useCallback((newText: string) => {
    setText(newText);
  }, []);
  
  // 컴포넌트를 useMemo로 메모이제이션
  const inputComponent = useMemo(() => (
    <TextInput
      value={text}
      onChangeText={handleTextChange}
      placeholder="입력하세요"
    />
  ), [text, handleTextChange]);
  
  return inputComponent;
};
```

## 🛠️ 실제 적용 사례: CleanIT Manager 회원가입

### 문제 발생 코드
```typescript
// ❌ 이전 코드 (문제 발생)
const ManagerSignupScreen = () => {
  const [userId, setUserId] = useState('');
  const [loading, setLoading] = useState(false);
  
  // 💥 매번 새로 생성되는 컴포넌트
  const FormInput = ({ label, value, onChangeText, ... }) => (
    <View>
      <Text>{label}</Text>
      <TextInput value={value} onChangeText={onChangeText} />
    </View>
  );
  
  return (
    <FormInput 
      label="로그인 ID"
      value={userId}
      onChangeText={setUserId}
    />
  );
};
```

### 해결된 코드
```typescript
// ✅ 해결된 코드
// 1. 컴포넌트 외부로 분리하여 리렌더링 최적화
const FormInput = React.memo(({ 
  label, 
  value, 
  onChangeText, 
  placeholder, 
  keyboardType = 'default',
  autoCapitalize = 'none',
  secureTextEntry = false,
  showPassword,
  onTogglePassword,
  icon,
  multiline = false,
  editable = true
}: {
  label: string;
  value: string;
  onChangeText: (text: string) => void;
  placeholder: string;
  keyboardType?: any;
  autoCapitalize?: any;
  secureTextEntry?: boolean;
  showPassword?: boolean;
  onTogglePassword?: () => void;
  icon: string;
  multiline?: boolean;
  editable?: boolean;
}) => (
  <View style={styles.inputContainer}>
    <Text style={styles.inputLabel}>{label}</Text>
    <View style={styles.inputWrapper}>
      <Text style={styles.inputIcon}>{icon}</Text>
      <TextInput
        style={styles.input}
        placeholder={placeholder}
        placeholderTextColor="#999"
        value={value}
        onChangeText={onChangeText}
        keyboardType={keyboardType}
        autoCapitalize={autoCapitalize}
        secureTextEntry={secureTextEntry && !showPassword}
        editable={editable}
        multiline={multiline}
        numberOfLines={multiline ? 3 : 1}
      />
      {secureTextEntry && onTogglePassword && (
        <TouchableOpacity onPress={onTogglePassword}>
          <Text>{showPassword ? '👁️' : '🙈'}</Text>
        </TouchableOpacity>
      )}
    </View>
  </View>
));

// 2. 메인 컴포넌트에서 사용
const ManagerSignupScreen = () => {
  const [userId, setUserId] = useState('');
  const [loading, setLoading] = useState(false);
  
  return (
    <FormInput
      label="로그인 ID"
      value={userId}
      onChangeText={setUserId}
      placeholder="4-20자 영문, 숫자, _ 사용"
      autoCapitalize="none"
      icon="🆔"
      editable={!loading} // 로딩 중에는 입력 비활성화
    />
  );
};
```

## 🔑 핵심 포인트

### 1. React.memo 사용
- **Props가 변경되지 않으면 컴포넌트 재사용**
- 불필요한 리렌더링 방지

### 2. 컴포넌트 외부 분리
- **함수형 컴포넌트를 외부에서 정의**
- 매번 새로운 함수 생성 방지

### 3. Props 일관성 유지
- **모든 Props를 명시적으로 전달**
- 타입 정의로 안정성 확보

### 4. editable 속성 활용
- **로딩 상태에 따른 입력 제어**
- 사용자 경험 개선

## ⚠️ 주의사항

### 1. 과도한 최적화 피하기
```typescript
// ❌ 과도한 최적화
const MyComponent = React.memo(React.memo(React.memo(Component)));

// ✅ 적절한 최적화
const MyComponent = React.memo(Component);
```

### 2. Props 변경 최소화
```typescript
// ❌ 매번 새로운 객체/함수 전달
<FormInput 
  style={{marginTop: 10}}  // 매번 새로운 객체
  onPress={() => doSomething()}  // 매번 새로운 함수
/>

// ✅ 안정적인 Props 전달
const styles = StyleSheet.create({
  input: { marginTop: 10 }
});

const handlePress = useCallback(() => {
  doSomething();
}, []);

<FormInput 
  style={styles.input}
  onPress={handlePress}
/>
```

### 3. key prop 주의
```typescript
// ❌ 동적 key 사용
<TextInput key={Math.random()} />

// ✅ 안정적인 key 사용
<TextInput key="user-id-input" />
```

## 📈 성능 개선 효과

### Before (문제 상황)
- ❌ 매번 컴포넌트 재생성
- ❌ TextInput 포커스 손실
- ❌ 사용자 경험 저하
- ❌ 불필요한 리렌더링

### After (해결 후)
- ✅ 컴포넌트 재사용
- ✅ TextInput 포커스 유지
- ✅ 원활한 타이핑 경험
- ✅ 성능 최적화

## 🔍 디버깅 팁

### 1. React DevTools 활용
```javascript
// 컴포넌트 리렌더링 확인
React.useEffect(() => {
  console.log('Component rendered');
});
```

### 2. why-did-you-render 라이브러리
```bash
npm install @welldone-software/why-did-you-render
```

### 3. 포커스 상태 추적
```typescript
const [isFocused, setIsFocused] = useState(false);

<TextInput
  onFocus={() => setIsFocused(true)}
  onBlur={() => setIsFocused(false)}
/>
```

## 📚 참고 자료

- [React Native Performance](https://reactnative.dev/docs/performance)
- [React.memo 공식 문서](https://react.dev/reference/react/memo)
- [React Native TextInput](https://reactnative.dev/docs/textinput)

---

**💡 결론**: React Native에서 TextInput 포커스 손실 문제는 대부분 **컴포넌트 재생성**이 원인입니다. `React.memo`와 **컴포넌트 외부 분리**를 통해 효과적으로 해결할 수 있습니다.